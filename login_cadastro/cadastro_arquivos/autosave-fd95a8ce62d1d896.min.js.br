"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="007aca96-b8dd-5c69-ae01-8e9006982208")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{879126:(e,a,t)=>{t.d(a,{AX:()=>f,Ay:()=>v,DA:()=>E,DD:()=>n,Fz:()=>y,IC:()=>k,Jm:()=>o,MV:()=>m,Ns:()=>h,O2:()=>d,QW:()=>w,Vw:()=>N,Vz:()=>u,dd:()=>i,eX:()=>r,fH:()=>x,hL:()=>_,ho:()=>c,jO:()=>p,ns:()=>A,r_:()=>g,rf:()=>s,yl:()=>l});let l="autosave_modal--modal--Egqg3",n="autosave_modal--title--Q-T-o",s="autosave_modal--body--pv4yP",o="autosave_modal--openFilesToSyncText--DI5lk",r="autosave_modal--fileRows--JQWy9",c="autosave_modal--fileRow--vBNLB",i="autosave_modal--userRows--fG3Qq",u="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",m="autosave_modal--onlyFileRowText--NGT-7",d="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",v="autosave_modal--fileMetadata--JIecy",E="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",_="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",f="autosave_modal--logOutButtons--961-N",g="autosave_modal--logOutDiscard--MvTW-",y="autosave_modal--logOutDone--cjhVr autosave_modal--flexRowEnd--UaYDp",h="autosave_modal--doneAndSync---UvWx autosave_modal--flexRowEnd--UaYDp",p="autosave_modal--expiryAndDone--ck-oP",N="autosave_modal--done--F-hm3",x="autosave_modal--expiryWrapper--1Ee1U",k="autosave_modal--expiry--E2Ybr",w="autosave_modal--warningIcon--T1wLu",A="autosave_modal--openToSync--KQUfj"},275081:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLearnMoreModal:()=>E});var l=t(411855),n=t(188507),s=t(862350),o=t(463033),r=t(951792),c=t(288006),i=t(966712),u=t(799569),m=t(939863),d=t(474742),v=t(879126);function E(e){let a=(0,n.wA)(),t=s.hS(e),E=l.createElement(o.$n,{variant:"secondary",onClick:e.onClose},(0,m.tx)("autosave.learn_more.done_button"));return(0,i.kc)().ss_fpl_multiplayer?l.createElement(r.bL,{manager:t,width:"lg"},l.createElement(c.vo,null,l.createElement(c.Y9,null,l.createElement(c.hE,null,(0,m.tx)("autosave.learn_more.title"))),l.createElement(c.nB,null,l.createElement("div",null,(0,m.tx)("autosave.learn_more.body_save_pending_changes")),l.createElement("div",{className:v.rf},(0,m.tx)("autosave.learn_more.body_use_version_history"))),l.createElement(c.wi,null,l.createElement(c.jk,null,E)))):l.createElement(d.aF,{className:v.yl},l.createElement(u.s_,{dispatch:a}),l.createElement("div",{className:v.DD},(0,m.tx)("autosave.learn_more.title")),l.createElement("div",{className:v.rf},(0,m.tx)("autosave.learn_more.body_save_pending_changes")),l.createElement("div",{className:v.rf},(0,m.tx)("autosave.learn_more.body_use_version_history")),l.createElement("div",{className:v.Fz},E))}},714932:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLogOutModal:()=>q,HasAutosaveChangesModal:()=>J});var l=t(411855),n=t(188507),s=t(561546),o=t(838516),r=t(268853),c=t(463033),i=t(951792),u=t(288006),m=t(862350),d=t(677469),v=t.n(d),E=t(517333),_=t(737947),f=t(966712),g=t(776621),y=t(553716),h=t(799569),p=t(946689),N=t(564577),x=t(163023),k=t(331737),w=t(842262),A=t(869381),C=t(154254),b=t(939863),D=t(119198),F=t(662275),L=t(788811),O=t(823699),S=t(63104),T=t(132367),$=t(860178),M=t(132135),j=t(565167),B=t(945020),R=t(754168),U=t(474742),I=t(879126),P=t(247866);function z(){return(0,f.kc)().ss_fpl_multiplayer}function V(e){return e.user?l.createElement("div",{className:I.O2},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function W(e,a){let t=!1,l=null;try{let{data:n}=await R.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=n.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(t=!0)}catch(e){404===e.status?t=!0:(0,y.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:t,unsyncedFile:a,figFile:l}}let Y=(e,a)=>(0,o.s)(()=>{let t=new URL((0,M.r1)(e,!0));t.searchParams.append("fuid",a),_.Ay.redirect(t.toString(),"_blank")}),G=(e,a)=>(0,o.s)(()=>e(D.NA({file:a,openNewFileIn:B.ai.NEW_TAB,source:j.U.AUTOSAVE_MODAL})));function K(e,a,t){return(0,S.y8)(a)?{fileName:a.file.name,onClick:Y(a.file,t.id),thumbnail:l.createElement(k.NU,{file:a.file,size:A.y.SMALL,borderRadius:4})}:{fileName:a.name,onClick:G(e,a),thumbnail:l.createElement(w.A,{listView:"slightly-larger"})}}function Q(e){let{fileName:a,onClick:t,thumbnail:s}=K((0,n.wA)(),e.fileState,e.user);return l.createElement("div",{className:I.ho,key:e.fileState.fileKey},l.createElement("div",{className:C.cx.hFull.$},s),l.createElement("div",{className:I.Ay},l.createElement("div",{className:I.DA},a),l.createElement("div",{className:I.hL},(0,b.tx)("tile.file_tile.edited_time",{time:l.createElement(N.h1,{date:e.fileState.lastUpdatedAt})}))),z()?l.createElement("div",{className:I.ns},l.createElement(c.$n,{variant:"secondary",onClick:t},(0,b.tx)("autosave.has_changes.open_to_sync"))):l.createElement(p.nR,{className:I.ns,onClick:t},(0,b.tx)("autosave.has_changes.open_to_sync")))}function H(e){return l.createElement("div",{className:I.dd},Object.keys(e.files).map(a=>l.createElement("div",{key:a,className:I.eX},l.createElement(V,{user:e.users.filter(e=>e?.id===a)[0]}),l.createElement("div",null,Object.values(e.files[a]).map(t=>l.createElement(Q,{fileState:t,user:e.users.filter(e=>e?.id===a)[0],key:t.fileKey}))))))}function X({modalManager:e,files:a,nextGarbageCollectionTimestamp:t,users:s,includeDismissButton:o,onDone:r}){let m;let d=(0,n.wA)(),E=r||(()=>{d(F.Ce())}),_=ee(t),f=(0,b.tx)("autosave.has_changes.sync_offline_changes"),g=1===v()(Object.values(a)).length,y=null,N=null,k=null,w=null,A=null;if(g){y=v()(Object.values(a))[0];let e=Object.keys(a).filter(e=>a[e].length>0)[0],t=K(d,y,N=s.filter(a=>a?.id===e)[0]);k=t.fileName,w=t.onClick,A=t.thumbnail,m=l.createElement(l.Fragment,null,l.createElement(V,{user:N}),l.createElement("div",{className:I.Vz},l.createElement("div",{className:C.cx.hFull.$},A),l.createElement("div",{className:I.MV},(0,b.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:l.createElement("span",{className:I.DD},k)}))))}else m=l.createElement(l.Fragment,null,l.createElement("div",{className:I.Jm},(0,b.tx)("autosave.has_changes.unsynced_changes_offline")),l.createElement(H,{files:a,users:s}));let D=_&&l.createElement("div",{className:I.fH},l.createElement(x.B,{svg:P.A,className:I.QW}),l.createElement("div",{className:I.IC},_)),L=o&&(z()?l.createElement(c.$n,{variant:"secondary",onClick:E},(0,b.tx)("autosave.has_changes.dismiss.later")):l.createElement(p.nR,{onClick:E},(0,b.tx)("autosave.has_changes.dismiss.later"))),O=g&&w&&(z()?l.createElement(c.$n,{variant:"primary",onClick:w},(0,b.tx)("autosave.has_changes.open_to_sync")):l.createElement(p.$$,{onClick:w},(0,b.tx)("autosave.has_changes.open_to_sync")));return z()?l.createElement(i.bL,{manager:e,width:"lg"},l.createElement(u.vo,null,l.createElement(u.Y9,null,l.createElement(u.hE,null,f)),l.createElement(u.nB,null,m),(D||L||O)&&l.createElement(u.wi,null,D,(L||O)&&l.createElement(u.jk,null,L,O)))):l.createElement(U.aF,{className:I.yl,size:500,tintedModalBackground:!0},l.createElement(h.s_,{dispatch:d}),l.createElement("div",{className:I.DD},f),l.createElement("div",null,m),(D||L||O)&&l.createElement("div",{className:I.jO},D,l.createElement("div",{className:I.Ns},L,O)))}function J(e){let a=m.hS(e),{unsyncedFiles:t,localUnsyncedFiles:s}=(0,L.Gg)(),o=(0,n.d4)(e=>e.modalShown),r=(0,n.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),c=(0,$.iZ)(),i=c?.id;return o&&i&&c?l.createElement(X,{modalManager:a,files:{[i]:[...t,...s]},nextGarbageCollectionTimestamp:r,users:[c],includeDismissButton:!0}):null}function Z(e){let a=m.hS(e),t=(0,n.wA)(),[s,o]=l.useState(!1),[r,d]=l.useState(!1),v=async()=>{try{for(let a of e.users){let e=a?.id;e&&await (0,L.go)((0,O.cu)(e))}}finally{d(!0)}},_=()=>{t(F.Lo())},f=()=>{o(!0)},g=0===Object.values(e.files).length;if(r||g&&e.loaded){let n=(0,b.tx)("autosave.logout.offline_changes"),s=r?(0,b.tx)("autosave.logout.offline_changes_discarded"):(0,b.tx)("autosave.logout.offline_changes_synced"),o=z()?l.createElement(c.$n,{variant:"secondary",onClick:e.onLogOut},(0,b.tx)("autosave.logout.log_out")):l.createElement(p.nR,{onClick:e.onLogOut},(0,b.tx)("autosave.logout.log_out"));return z()?l.createElement(i.bL,{width:"md",manager:a},l.createElement(u.vo,null,l.createElement(u.Y9,null,l.createElement(u.hE,null,n)),l.createElement(u.nB,null,s),l.createElement(u.wi,null,l.createElement(u.jk,null,o)))):l.createElement(U.aF,{className:I.yl,size:384,tintedModalBackground:!0},l.createElement(h.s_,{dispatch:t}),l.createElement("div",{className:I.DD},n),l.createElement("div",{className:I.rf},s),l.createElement("div",{className:I.Vw},o))}if(s)return l.createElement(X,{...e,modalManager:a,onDone:()=>{o(!1)}});{let n,s,o;let r=(0,b.tx)("autosave.has_changes.sync_offline_changes"),m=E.eD?(0,b.t)("autosave.logout.log_out_text.desktop"):(0,b.t)("autosave.logout.log_out_text.web");return E.eD?(n=z()?l.createElement(c.$n,{variant:"destructiveSecondary",onClick:v},(0,b.tx)("autosave.logout.discard_and_logout")):l.createElement(p.s6,{onClick:v},(0,b.tx)("autosave.logout.discard_and_logout")),s=z()?l.createElement(c.$n,{variant:"secondary",onClick:_},(0,b.tx)("autosave.logout.cancel")):l.createElement(p.nR,{onClick:_},(0,b.tx)("autosave.logout.cancel")),o=z()?l.createElement(c.$n,{variant:"secondary",onClick:f},(0,b.tx)("autosave.logout.show_changes")):l.createElement(p.nR,{onClick:f},(0,b.tx)("autosave.logout.show_changes"))):(n=z()?l.createElement(c.$n,{variant:"destructiveSecondary",onClick:v},(0,b.tx)("autosave.logout.discard")):l.createElement(p.s6,{onClick:v},(0,b.tx)("autosave.logout.discard")),s=z()?l.createElement(c.$n,{variant:"secondary",onClick:e.onLogOut},(0,b.tx)("autosave.logout.log_out")):l.createElement(p.nR,{onClick:e.onLogOut},(0,b.tx)("autosave.logout.log_out")),o=z()?l.createElement(c.$n,{variant:"primary",onClick:f},(0,b.tx)("autosave.logout.sync_changes")):l.createElement(p.$$,{onClick:f},(0,b.tx)("autosave.logout.sync_changes"))),z()?l.createElement(i.bL,{manager:a,width:"lg"},l.createElement(u.vo,null,l.createElement(u.Y9,null,l.createElement(u.hE,null,r)),l.createElement(u.nB,null,m),l.createElement(u.wi,null,n,l.createElement(u.jk,null,s,o)))):l.createElement(U.aF,{className:I.yl,size:424,tintedModalBackground:!0},l.createElement(h.s_,{dispatch:t}),l.createElement("div",{className:I.DD},r),l.createElement("div",{className:I.rf},m),l.createElement("div",{className:I.AX},l.createElement("div",{className:I.r_},n),l.createElement("div",{className:I.Fz},s,o)))}}function q(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:t,loaded:o,autosaveFilesToDelete:c}=function(e){let a=(0,n.wA)(),[t,o]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let a=async()=>{try{let a=await (0,L.ZW)((0,s.WI)(e.map(e=>e?.id))),t={},l=[],n=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)n.push(W(e,a));for(let a of l.newFiles)e in t||(t[e]=[]),t[e].push(a)}for(let e of(await Promise.all(n))){let a=e.userID;e.shouldDeleteFile?l.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in t||(t[a]=[]),t[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let r=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));o({multiUserGarbageCollectionTimestamp:r,multiUserUnsyncedFiles:t,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,y.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,g.$D)(r.e.SCENEGRAPH_AND_SYNC,e)):(0,g.$D)(r.e.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return T.hp.register(T.a,a),a(),function(){T.hp.unregister(T.a,a)}},[a,e]),t}(e.users);return(0,$.TA)()?l.createElement(Z,{...e,loaded:o,nextGarbageCollectionTimestamp:t,files:a,onLogOut:()=>{for(let e of c)(0,L.go)((0,O.Zt)(e.userID,e.fileKey)).catch(e=>{(0,g.$D)(r.e.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}J.displayName="HasAutosaveChangesModal";let ee=e=>{let a=Math.floor(((0,L.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?(0,b.tx)("autosave.has_changes.expiry_text_shortly"):(0,b.tx)("autosave.has_changes.expiry_text_days",{days:a})};q.displayName="AutosaveLogOutModal"},528752:(e,a,t)=>{t.r(a),t.d(a,{AutosaveNewFileAlreadyOpenModal:()=>g});var l=t(411855),n=t(188507),s=t(862350),o=t(951792),r=t(288006),c=t(463033),i=t(776250),u=t(966712),m=t(946689),d=t(154254),v=t(939863),E=t(662275),_=t(474742),f=t(879126);function g(e){let a=(0,n.wA)();(0,l.useEffect)(()=>(0,i.sx)("New Autosave File Already Open Modal Shown"));let t=()=>a(E.Ce()),g=s.hS({open:!0,onClose:t});return(0,u.kc)().ss_fpl_multiplayer?l.createElement(o.bL,{manager:g,width:360},l.createElement(r.vo,null,l.createElement(r.Y9,null,l.createElement(r.hE,null,(0,v.tx)("autosave.file_already_open_modal.title"))),l.createElement(r.nB,null,(0,v.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:d.cx.fontSemiBold.$},e.file.name)})),l.createElement(r.wi,null,l.createElement(r.jk,null,l.createElement(c.$n,{variant:"secondary",onClick:t},(0,v.tx)("general.ok")))))):l.createElement(_.aF,{size:360,tintedModalBackground:!0},l.createElement("div",{className:f.DD},(0,v.tx)("autosave.file_already_open_modal.title")),l.createElement("div",{className:f.rf},(0,v.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:d.cx.fontSemiBold.$},e.file.name)})),l.createElement("div",{className:f.Vw},l.createElement(m.nR,{onClick:t},(0,v.tx)("general.ok"))))}g.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=007aca96-b8dd-5c69-ae01-8e9006982208

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/92eafee86a29452dc4fb4e227dad67e6a0d25e58/autosave-fd95a8ce62d1d896.min.js.map